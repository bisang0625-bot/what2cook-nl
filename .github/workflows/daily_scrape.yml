name: Daily Scraper - Update Sales Data (DEPRECATED - DISABLED)

# âš ï¸ ì´ ì›Œí¬í”Œë¡œìš°ëŠ” ë” ì´ìƒ ì‚¬ìš©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
# ìƒˆë¡œìš´ smart_scraper.ymlì„ ì‚¬ìš©í•˜ì„¸ìš”.
# ì´ ì›Œí¬í”Œë¡œìš°ëŠ” ì™„ì „ížˆ ë¹„í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤.

on:
  # ëª¨ë“  íŠ¸ë¦¬ê±° ë¹„í™œì„±í™”
  # schedule:
  # workflow_dispatch:

jobs:
  scrape-and-commit:
    runs-on: ubuntu-22.04
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          fetch-depth: 0 # ì „ì²´ ížˆìŠ¤í† ë¦¬ í•„ìš” (git diffë¥¼ ìœ„í•´)

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.9'

      - name: Cache pip packages
        uses: actions/cache@v3
        with:
          path: ~/.cache/pip
          key: ${{ runner.os }}-pip-${{ hashFiles('requirements.txt') }}
          restore-keys: |
            ${{ runner.os }}-pip-

      - name: Install Python dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: Install Playwright browsers
        run: |
          playwright install chromium --with-deps

      - name: Configure Git
        run: |
          # Git ì„¤ì • (ì»¤ë°‹ì„ ìœ„í•œ ì‚¬ìš©ìž ì •ë³´)
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"

      - name: Run scraper
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        run: |
          # main_scraper.py ì‹¤í–‰ (weekly_sales.json ìƒì„±)
          # ë˜ëŠ” hybrid_scraper.pyë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ ì•„ëž˜ ì£¼ì„ì„ í•´ì œí•˜ì„¸ìš”:
          # python scrapers/hybrid_scraper.py
          python scrapers/main_scraper.py
        continue-on-error: true # ìŠ¤í¬ëž˜í¼ ì‹¤íŒ¨í•´ë„ ì»¤ë°‹ì€ ì‹œë„

      - name: Check for changes
        id: check-changes
        run: |
          if [ -n "$(git status --porcelain data/*.json)" ]; then
            echo "changed=true" >> $GITHUB_OUTPUT
            echo "ðŸ“ JSON íŒŒì¼ ë³€ê²½ ê°ì§€ë¨"
            git status --short data/
          else
            echo "changed=false" >> $GITHUB_OUTPUT
            echo "âœ… ë³€ê²½ ì‚¬í•­ ì—†ìŒ"
          fi

      - name: Commit and push changes
        if: steps.check-changes.outputs.changed == 'true'
        run: |
          git add data/*.json
          git commit -m "bot: update daily sales data [skip ci]" || exit 0
          git push || exit 0
          echo "âœ… ë³€ê²½ ì‚¬í•­ ì»¤ë°‹ ë° í‘¸ì‹œ ì™„ë£Œ"

      - name: Summary
        if: always()
        run: |
          echo "## Daily Scraper ì‹¤í–‰ ê²°ê³¼" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          if [ "${{ steps.check-changes.outputs.changed }}" == "true" ]; then
            echo "âœ… **ë³€ê²½ ì‚¬í•­ ê°ì§€ë¨** - ë°ì´í„°ê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤." >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "ë³€ê²½ëœ íŒŒì¼:" >> $GITHUB_STEP_SUMMARY
            git diff --name-only HEAD~1 data/ 2>/dev/null || git status --short data/ >> $GITHUB_STEP_SUMMARY || echo "íŒŒì¼ ëª©ë¡ì„ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤." >> $GITHUB_STEP_SUMMARY
          else
            echo "â„¹ï¸ **ë³€ê²½ ì‚¬í•­ ì—†ìŒ** - ëª¨ë“  ë°ì´í„°ê°€ ìµœì‹  ìƒíƒœìž…ë‹ˆë‹¤." >> $GITHUB_STEP_SUMMARY
          fi
